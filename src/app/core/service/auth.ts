import { Injectable, signal } from '@angular/core';

// -------------------------------------------------------------------------
// 1. กำหนดโครงสร้างข้อมูล (Interface) ของผู้ใช้งาน
// -------------------------------------------------------------------------
// การสร้าง Interface ช่วยให้ TypeScript ตรวจสอบความถูกต้องของข้อมูลได้ (Type Safety)
// เวลาเรียกใช้ user.name หรือ user.role จะมี Auto-complete ขึ้นให้
export interface User {
  name: string;         // ชื่อ-นามสกุล
  role: string;         // ตำแหน่ง หรือ สิทธิ์การใช้งาน (Role)
  department: string;   // หน่วยงานที่สังกัด
  image: string | null; // URL รูปภาพโปรไฟล์ (ให้เป็น null ได้ ถ้าไม่มีรูป)
}

@Injectable({
  providedIn: 'root', // กำหนดให้ Service นี้เป็น Singleton (มีตัวเดียว ใช้ร่วมกันทั้งแอป)
})
export class Auth {

  // -------------------------------------------------------------------------
  // 2. State เก็บข้อมูลผู้ใช้ปัจจุบัน (ใช้ Signal)
  // -------------------------------------------------------------------------
  // ใช้ signal<User | null> เพื่อบอกว่าค่าข้างในเป็นได้ทั้ง "ข้อมูล User" หรือ "null" (ยังไม่ Login)
  // ข้อดีของ Signal: เมื่อค่าเปลี่ยน Component ไหนที่ใช้ค่านี้อยู่ จะอัปเดตหน้าจอให้อัตโนมัติ
  currentUser = signal<User | null>({
    name: 'ฐิติมา',
    role: 'Super Admin',
    department: 'กองบริหารการสาธารณสุข',
    image: null
  }); 
  // หมายเหตุ: ตรงนี้ใส่ Mock Data (ข้อมูลจำลอง) ไว้ก่อน เพื่อให้เทสหน้าจอได้เลยโดยไม่ต้อง Login จริง

  constructor() { }

  // -------------------------------------------------------------------------
  // 3. ฟังก์ชันออกจากระบบ (Logout)
  // -------------------------------------------------------------------------
  logout() {
    // ใช้ .set(null) เพื่อล้างค่าใน Signal (ทำให้สถานะกลายเป็น "ไม่มีผู้ใช้งาน")
    this.currentUser.set(null); 
    
    console.log('User logged out');
    
    // TODO: ในอนาคตต้อง Inject Router เข้ามาเพื่อสั่งเปลี่ยนหน้า
    // this.router.navigate(['/login']);
  }
}